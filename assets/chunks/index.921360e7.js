var x=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Z={},T={},z={};Object.defineProperty(z,"__esModule",{value:!0});z.getUniqueId=z.mergeTransactions=z.AddressLiteral=z.Address=void 0;class W{constructor(e){this._address=e}toString(){return this._address}equals(e){return e instanceof W?this._address==e._address:this._address==e}}z.Address=W;class tt extends W{constructor(e){super(e)}}z.AddressLiteral=tt;function et(i,e,t){if(t.batchType=="old")return i.push(...e),i;if(i.length===0)return i.push(...e),i;let n=0;for(;n<i.length&&i[n].id.lt.localeCompare(t.maxLt)>=0;)++n;return i.splice(n,0,...e),i}z.mergeTransactions=et;const V=4294967295;let B=Math.floor(Math.random()*V);function st(){return B=(B+1)%V,B}z.getUniqueId=st;Object.defineProperty(T,"__esModule",{value:!0});T.parseTokensObject=T.serializeTokensObject=T.parseAccountInteraction=T.parsePermissions=T.parseMessage=T.serializeMessage=T.parseTransaction=T.serializeTransaction=void 0;const U=z;function it(i){return{...i,inMessage:H(i.inMessage),outMessages:i.outMessages.map(H)}}T.serializeTransaction=it;function nt(i){return{...i,inMessage:K(i.inMessage),outMessages:i.outMessages.map(K)}}T.parseTransaction=nt;function H(i){return{...i,src:i.src?i.src.toString():void 0,dst:i.dst?i.dst.toString():void 0}}T.serializeMessage=H;function K(i){return{...i,src:i.src?new U.Address(i.src):void 0,dst:i.dst?new U.Address(i.dst):void 0}}T.parseMessage=K;function rt(i){return{...i,accountInteraction:i.accountInteraction?G(i.accountInteraction):void 0}}T.parsePermissions=rt;function G(i){return{...i,address:new U.Address(i.address)}}T.parseAccountInteraction=G;function at(i){return N(i)}T.serializeTokensObject=at;function N(i){if(i instanceof U.Address)return i.toString();if(Array.isArray(i)){const e=[];for(const t of i)e.push(N(t));return e}else if(i!=null&&typeof i=="object"){const e={};for(const[t,n]of Object.entries(i))e[t]=N(n);return e}else return i}function ot(i,e){const t={};for(const n of i)t[n.name]=L(n,e[n.name]);return t}T.parseTokensObject=ot;function L(i,e){if(i.type.startsWith("map")){let[t,n]=i.type.split(",");t=t.slice(4),n=n.slice(0,-1);const a=[];for(const[o,r]of e)a.push([L({name:"",type:t},o),L({name:"",type:n,components:i.components},r)]);return a}else{const t=i.type.endsWith("[]"),n=!t&&i.type.startsWith("optional"),a=t?i.type.slice(0,-2):n?i.type.slice(9,-1):i.type;if(t){const o={name:i.name,type:a,components:i.components},r=[];for(const u of e)r.push(L(o,u));return r}else if(n){if(e==null)return null;{const o={name:i.name,type:a,components:i.components};return L(o,e)}}else if(a=="tuple"){const o={};if(i.components!=null)for(const r of i.components)o[r.name]=L(r,e[r.name]);return o}else return a=="address"?new U.Address(e):e}}var R={};Object.defineProperty(R,"__esModule",{value:!0});R.Subscriber=void 0;const $=z;class ct{constructor(e){this.provider=e,this.subscriptions={},this.scanners={}}transactions(e){return this._addSubscription("transactionsFound",e,!1)}oldTransactions(e,t){const n=(0,$.getUniqueId)();return new A(async(a,o)=>{const r=new ut(this.provider,{address:e,onData:a,onEnd:o,...t});this.scanners[n]=r,await r.start()},async()=>{const a=this.scanners[n];delete this.scanners[n],a!=null&&await a.stop()},J,!0)}states(e){return this._addSubscription("contractStateChanged",e,!1)}async unsubscribe(){const e=Object.assign({},this.subscriptions);for(const n of Object.keys(this.subscriptions))delete this.subscriptions[n];const t=Object.assign({},this.scanners);for(const n of Object.keys(this.scanners))delete this.scanners[n];await Promise.all(Object.values(e).map(async n=>{const a=Object.assign({},n);for(const o of Object.keys(a))delete n[o];await Promise.all(Object.values(a).map(o=>{if(o!=null)return o.subscription.then(r=>r.unsubscribe()).catch(()=>{})}))}).concat(Object.values(t).map(n=>n.stop())))}_addSubscription(e,t,n){const a=t.toString(),o=u=>{const b=this.subscriptions[a];if(b==null)return;const p=b[e];if(p!=null){const h=p.handlers[u];if(h!=null){delete p.handlers[u];const{queue:v,onEnd:P,state:w}=h;w.finished||(w.finished=!0,v.clear(),v.enqueue(async()=>P(w.eof)))}if(Object.keys(p.handlers).length===0){const v=p.subscription;delete b[e],v.then(P=>P.unsubscribe()).catch(console.debug)}}Object.keys(b).length===0&&delete this.subscriptions[a]},r=(0,$.getUniqueId)().toString();return new A((u,b)=>{let p=this.subscriptions[a],h=p==null?void 0:p[e];const v={eof:!1,finished:!1},P={onData:u,onEnd:b,queue:new Q,state:v};if(h!=null){h.handlers[r]=P;return}const w={[r]:P};h={subscription:this.provider.subscribe(e,{address:t}).then(I=>(I.on("data",C=>{Object.values(w).forEach(({onData:E,queue:y,state:l})=>{l.eof||l.finished||y.enqueue(async()=>{await E(C)||(l.eof=!0,o(r))})})}),I.on("unsubscribed",()=>{Object.keys(w).forEach(o)}),I)).catch(I=>{throw console.error(I),Object.keys(w).forEach(o),I}),handlers:w},p==null?this.subscriptions[a]={[e]:h}:p[e]=h},()=>o(r),J,n)}}R.Subscriber=ct;async function J(i,e){return e(i)}class A{constructor(e,t,n,a){this.makeProducer=e,this.stopProducer=t,this.extractor=n,this.isFinite=a,this.fold=this.onlyFinite((o,r)=>{let u=o;return new Promise(async(b,p)=>{this.makeProducer(h=>this.extractor(h,async v=>(u=await r(u,v),!0)),h=>{h?b(u):p(new Error("Subscription closed"))})})}),this.finished=this.onlyFinite(()=>new Promise(async(o,r)=>{this.makeProducer(u=>this.extractor(u,b=>!0),u=>{u?o(void 0):r(new Error("Subscription closed"))})}))}first(){let e={found:!1};return new Promise(async(t,n)=>{this.makeProducer(a=>this.extractor(a,o=>(Object.assign(e,{found:!0,result:o}),!1)),a=>{a?this.isFinite?t(e.found?e.result:void 0):e.found?t(e.result):n(new Error("Unexpected end of stream")):n(new Error("Subscription closed"))})})}on(e){this.makeProducer(t=>this.extractor(t,async n=>(await e(n),!0)),t=>{})}merge(e){return new A((t,n)=>{const a={stopped:!1,counter:0},o=r=>{a.stopped||(++a.counter==2||!r)&&(a.stopped=!0,n(r))};this.makeProducer(t,o),e.makeProducer(t,o)},()=>{this.stopProducer(),e.stopProducer()},this.extractor,this.isFinite&&e.isFinite)}enumerate(){const e={index:0};return new A(this.makeProducer,this.stopProducer,(t,n)=>this.extractor(t,async a=>n({index:e.index++,item:a})),this.isFinite)}tap(e){return new A(this.makeProducer,this.stopProducer,(t,n)=>this.extractor(t,async a=>(await e(a),n(a))),this.isFinite)}filter(e){return new A(this.makeProducer,this.stopProducer,(t,n)=>this.extractor(t,async a=>await e(a)?n(a):!0),this.isFinite)}filterMap(e){return new A(this.makeProducer,this.stopProducer,(t,n)=>this.extractor(t,async a=>{const o=await e(a);return o!==void 0?n(o):!0}),this.isFinite)}map(e){return new A(this.makeProducer,this.stopProducer,(t,n)=>this.extractor(t,async a=>{const o=await e(a);return n(o)}),this.isFinite)}flatMap(e){return new A(this.makeProducer,this.stopProducer,(t,n)=>this.extractor(t,async a=>{const o=await e(a);for(const r of o)if(!await n(r))return!1;return!0}),this.isFinite)}skip(e){const t={index:0};return new A(this.makeProducer,this.stopProducer,(n,a)=>this.extractor(n,o=>t.index>=e?a(o):(++t.index,!0)),this.isFinite)}skipWhile(e){const t={shouldSkip:!0};return new A(this.makeProducer,this.stopProducer,(n,a)=>this.extractor(n,async o=>!t.shouldSkip||!await e(o)?(t.shouldSkip=!1,a(o)):!0),this.isFinite)}take(e){const t={index:0};return new A(this.makeProducer,this.stopProducer,(n,a)=>this.extractor(n,o=>t.index<e?(++t.index,a(o)):!1),!0)}takeWhile(e){return new A(this.makeProducer,this.stopProducer,(t,n)=>this.extractor(t,async a=>await e(a)?n(a):!1),!0)}takeWhileMap(e){return new A(this.makeProducer,this.stopProducer,(t,n)=>this.extractor(t,async a=>{const o=await e(a);return o!==void 0?n(o):!1}),!0)}onlyFinite(e){if(this.isFinite)return e}}class ut{constructor(e,t){this.provider=e,this.params=t,this.queue=new Q,this.isRunning=!1}async start(){this.isRunning||this.promise!=null||(this.isRunning=!0,this.promise=(async()=>{const e=this.params;let t={complete:!1};for(;this.isRunning&&!t.complete;)try{const{transactions:n,continuation:a}=await this.provider.getTransactions({address:this.params.address,continuation:this.continuation});if(t.complete=!t.complete&&n.length==null,!this.isRunning||t.complete)break;const o=n.filter(u=>(e.fromLt==null||u.id.lt>e.fromLt)&&(e.fromUtime==null||u.createdAt>e.fromUtime));if(o.length==0){t.complete=!0;break}const r=o.filter(u=>(e.toLt==null||u.id.lt<e.toLt)&&(e.toUtime==null||u.createdAt<e.toUtime));if(r.length>0){const u={maxLt:r[0].id.lt,minLt:r[r.length-1].id.lt,batchType:"old"};this.queue.enqueue(async()=>{this.params.onData({address:this.params.address,transactions:r,info:u})||(t.complete=!0,this.isRunning=!1)})}if(a!=null)this.continuation=a;else{t.complete=!0;break}}catch(n){console.error(n)}this.queue.enqueue(async()=>this.params.onEnd(t.complete)),this.isRunning=!1,this.continuation=void 0})())}async stop(){this.isRunning=!1,this.queue.clear(),this.promise!=null?await this.promise:this.params.onEnd(!1)}}class Q{constructor(){this.queue=[],this.workingOnPromise=!1}enqueue(e){this.queue.push(e),this._dequeue().catch(()=>{})}clear(){this.queue.length=0}async _dequeue(){if(this.workingOnPromise)return;const e=this.queue.shift();!e||(this.workingOnPromise=!0,e().then(()=>{this.workingOnPromise=!1,this._dequeue()}).catch(()=>{this.workingOnPromise=!1,this._dequeue()}))}}var F={};Object.defineProperty(F,"__esModule",{value:!0});F.TvmException=F.Contract=void 0;const S=T;class dt{constructor(e,t,n){if(!Array.isArray(t.functions))throw new Error("Invalid abi. Functions array required");if(!Array.isArray(t.events))throw new Error("Invalid abi. Events array required");this._provider=e,this._abi=JSON.stringify(t),this._functions=t.functions.reduce((o,r)=>(o[r.name]={inputs:r.inputs||[],outputs:r.outputs||[]},o),{}),this._events=t.events.reduce((o,r)=>(o[r.name]={inputs:r.inputs||[]},o),{}),this._address=n;class a{constructor(r,u,b,p,h,v){this.provider=r,this.functionAbi=u,this.abi=b,this.address=p,this.method=h,this.params=(0,S.serializeTokensObject)(v)}async send(r){await this.provider.ensureInitialized();const{transaction:u}=await this.provider.rawApi.sendMessage({sender:r.from.toString(),recipient:this.address.toString(),amount:r.amount,bounce:r.bounce==null?!0:r.bounce,payload:{abi:this.abi,method:this.method,params:this.params}});return(0,S.parseTransaction)(u)}async sendWithResult(r){await this.provider.ensureInitialized();let u=r.subscriber;const b=u==null;u==null&&(u=new this.provider.Subscriber);try{let p,h;const v=new Promise(y=>{h=l=>y(l)}),P=[];u.transactions(this.address).flatMap(y=>y.transactions).filter(y=>{var l;return((l=y.inMessage.src)===null||l===void 0?void 0:l.equals(r.from))||!1}).on(y=>{p==null?P.push(y):p.possibleMessages.findIndex(l=>l.hash==y.inMessage.hash)>=0&&(h==null||h(y))});const w=await this.send(r),j=w.outMessages.filter(y=>{var l;return((l=y.dst)===null||l===void 0?void 0:l.equals(this.address))||!1});p={transaction:w,possibleMessages:j};const I=P.find(y=>j.findIndex(l=>l.hash==y.inMessage.hash)>=0);I!=null&&(h==null||h(I));const C=await v;let E;try{const y=await this.provider.rawApi.decodeTransaction({transaction:(0,S.serializeTransaction)(C),abi:this.abi,method:this.method});y!=null&&(E=this.functionAbi.outputs!=null?(0,S.parseTokensObject)(this.functionAbi.outputs,y.output):{})}catch(y){console.error(y)}return{parentTransaction:p.transaction,childTransaction:C,output:E}}finally{b&&await u.unsubscribe()}}async estimateFees(r){await this.provider.ensureInitialized();const{fees:u}=await this.provider.rawApi.estimateFees({sender:r.from.toString(),recipient:this.address.toString(),amount:r.amount,payload:{abi:this.abi,method:this.method,params:this.params}});return u}async sendExternal(r){await this.provider.ensureInitialized();let u=r.withoutSignature===!0?this.provider.rawApi.sendUnsignedExternalMessage:this.provider.rawApi.sendExternalMessage,{transaction:b,output:p}=await u({publicKey:r.publicKey,recipient:this.address.toString(),stateInit:r.stateInit,payload:{abi:this.abi,method:this.method,params:this.params},local:r.local});return{transaction:(0,S.parseTransaction)(b),output:p!=null?(0,S.parseTokensObject)(this.functionAbi.outputs,p):void 0}}async call(r={}){await this.provider.ensureInitialized();let{output:u,code:b}=await this.provider.rawApi.runLocal({address:this.address.toString(),cachedState:r.cachedState,responsible:r.responsible,functionCall:{abi:this.abi,method:this.method,params:this.params}});if(u==null||b!=0)throw new X(b);return(0,S.parseTokensObject)(this.functionAbi.outputs,u)}async encodeInternal(){await this.provider.ensureInitialized();let{boc:r}=await this.provider.rawApi.encodeInternalInput({abi:this.abi,method:this.method,params:this.params});return r}}this._methods=new Proxy({},{get:(o,r)=>{const u=this._functions[r];return b=>new a(this._provider,u,this._abi,this._address,r,b)}})}get methods(){return this._methods}get address(){return this._address}get abi(){return this._abi}async waitForEvent(e={}){const{range:t,filter:n}=e;let a=e.subscriber;const o=a==null;a==null&&(a=new this._provider.Subscriber);const r=await((t==null?void 0:t.fromLt)!=null||(t==null?void 0:t.fromUtime)!=null?a.oldTransactions(this._address,t).merge(a.transactions(this._address)):a.transactions(this.address)).flatMap(u=>u.transactions).takeWhile(u=>t==null||(t.fromLt==null||u.id.lt>t.fromLt)&&(t.fromUtime==null||u.createdAt>t.fromUtime)&&(t.toLt==null||u.id.lt<t.toLt)&&(t.toUtime==null||u.createdAt<t.toUtime)).flatMap(u=>this.decodeTransactionEvents({transaction:u}).then(b=>(b.forEach(p=>p.transaction=u),b))).filterMap(async u=>{if(n==null||await n(u))return u}).first();return o&&await a.unsubscribe(),r}async getPastEvents(e){const{range:t,filter:n,limit:a}=e;let o=[],r=e==null?void 0:e.continuation;t:for(;;){const{transactions:u,continuation:b}=await this._provider.getTransactions({address:this._address,continuation:r});if(u.length===null)break;const p=u.filter(h=>((t==null?void 0:t.fromLt)==null||h.id.lt>t.fromLt)&&((t==null?void 0:t.fromUtime)==null||h.createdAt>t.fromUtime)&&((t==null?void 0:t.toLt)==null||h.id.lt<(t==null?void 0:t.toLt))&&((t==null?void 0:t.toUtime)==null||h.createdAt<(t==null?void 0:t.toUtime)));if(p.length>0){const h=await Promise.all(p.map(async v=>({tx:v,events:await this.decodeTransactionEvents({transaction:v}).then(P=>(P.forEach(w=>w.transaction=v),P))})));for(let{tx:v,events:P}of h){n!=null&&(P=await Promise.all(P.map(async w=>await n(w)?w:void 0)).then(w=>w.filter(j=>j!=null))),r=v.id;for(const w of P){if(a!=null&&o.length>=a)break t;o.push(w)}if(a!=null&&o.length>=a)break t}}if(r=b,r==null)break}return{events:o,continuation:r}}async decodeTransaction(e){await this._provider.ensureInitialized();try{const t=await this._provider.rawApi.decodeTransaction({transaction:(0,S.serializeTransaction)(e.transaction),abi:this._abi,method:e.methods});if(t==null)return;let{method:n,input:a,output:o}=t;const r=this._functions[n];return{method:n,input:r.inputs!=null?(0,S.parseTokensObject)(r.inputs,a):{},output:r.outputs!=null?(0,S.parseTokensObject)(r.outputs,o):{}}}catch{return}}async decodeTransactionEvents(e){await this._provider.ensureInitialized();try{const{events:t}=await this._provider.rawApi.decodeTransactionEvents({transaction:(0,S.serializeTransaction)(e.transaction),abi:this._abi}),n=[];for(const{event:a,data:o}of t){const r=this._events[a];n.push({event:a,data:r.inputs!=null?(0,S.parseTokensObject)(r.inputs,o):{}})}return n}catch{return[]}}async decodeInputMessage(e){await this._provider.ensureInitialized();try{const t=await this._provider.rawApi.decodeInput({abi:this._abi,body:e.body,internal:e.internal,method:e.methods});if(t==null)return;let{method:n,input:a}=t;const o=this._functions[n];return{method:n,input:o.inputs!=null?(0,S.parseTokensObject)(o.inputs,a):{}}}catch{return}}async decodeOutputMessage(e){await this._provider.ensureInitialized();try{const t=await this._provider.rawApi.decodeOutput({abi:this._abi,body:e.body,method:e.methods});if(t==null)return;let{method:n,output:a}=t;const o=this._functions[n];return{method:n,output:o.outputs!=null?(0,S.parseTokensObject)(o.outputs,a):{}}}catch{return}}}F.Contract=dt;class X extends Error{constructor(e){super(`TvmException: ${e}`),this.code=e}}F.TvmException=X;var Y={};Object.defineProperty(Y,"__esModule",{value:!0});(function(i){var e=x&&x.__createBinding||(Object.create?function(l,s,c,d){d===void 0&&(d=c);var f=Object.getOwnPropertyDescriptor(s,c);(!f||("get"in f?!s.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return s[c]}}),Object.defineProperty(l,d,f)}:function(l,s,c,d){d===void 0&&(d=c),l[d]=s[c]}),t=x&&x.__setModuleDefault||(Object.create?function(l,s){Object.defineProperty(l,"default",{enumerable:!0,value:s})}:function(l,s){l.default=s}),n=x&&x.__importStar||function(l){if(l&&l.__esModule)return l;var s={};if(l!=null)for(var c in l)c!=="default"&&Object.prototype.hasOwnProperty.call(l,c)&&e(s,l,c);return t(s,l),s},a=x&&x.__exportStar||function(l,s){for(var c in l)c!=="default"&&!Object.prototype.hasOwnProperty.call(s,c)&&e(s,l,c)};Object.defineProperty(i,"__esModule",{value:!0}),i.ProviderNotInitializedException=i.ProviderNotFoundException=i.ProviderRpcClient=i.hasEverscaleProvider=i.mergeTransactions=i.AddressLiteral=i.Address=i.Subscriber=void 0;const o=T,r=z,u=n(R),b=n(F);a(Y,i),a(T,i),a(F,i);var p=R;Object.defineProperty(i,"Subscriber",{enumerable:!0,get:function(){return p.Subscriber}});var h=z;Object.defineProperty(i,"Address",{enumerable:!0,get:function(){return h.Address}}),Object.defineProperty(i,"AddressLiteral",{enumerable:!0,get:function(){return h.AddressLiteral}}),Object.defineProperty(i,"mergeTransactions",{enumerable:!0,get:function(){return h.mergeTransactions}});const v=typeof window!="undefined"&&typeof window.document!="undefined";let P;!v||document.readyState=="complete"?P=Promise.resolve():P=new Promise(l=>{window.addEventListener("load",()=>{l()})});const w=()=>v?window.__ever||window.ton:void 0;async function j(){return v?(await P,window.__hasEverscaleProvider===!0||window.hasTonProvider===!0):!1}i.hasEverscaleProvider=j;class I{constructor(s={}){this._subscriptions={},this._contractSubscriptions={},this._properties=s;const c=this;class d extends b.Contract{constructor(m,_){super(c,m,_)}}this.Contract=d;class f extends u.Subscriber{constructor(){super(c)}}this.Subscriber=f,this._api=new Proxy({},{get:(g,m)=>_=>{if(this._provider!=null)return this._provider.request({method:m,params:_});throw new E}}),s.forceUseFallback===!0?this._initializationPromise=s.fallback!=null?s.fallback().then(g=>{this._provider=g}):Promise.resolve():(this._provider=w(),this._provider!=null?this._initializationPromise=Promise.resolve():this._initializationPromise=j().then(g=>new Promise(m=>{if(!g)return m();if(this._provider=w(),this._provider!=null)m();else{const _=window.__hasEverscaleProvider===!0?"ever#initialized":"ton#initialized";window.addEventListener(_,O=>{this._provider=w(),m()})}})).then(async()=>{this._provider==null&&s.fallback!=null&&(this._provider=await s.fallback())})),this._initializationPromise.then(()=>{this._provider!=null&&this._registerEventHandlers(this._provider)})}async hasProvider(){return this._properties.fallback!=null?!0:j()}async ensureInitialized(){if(await this._initializationPromise,this._provider==null)throw new C}get isInitialized(){return this._provider!=null}get raw(){if(this._provider!=null)return this._provider;throw new E}get rawApi(){return this._api}createContract(s,c){return new this.Contract(s,c)}createSubscriber(){return new this.Subscriber}async requestPermissions(s){await this.ensureInitialized();const c=await this._api.requestPermissions({permissions:s.permissions});return(0,o.parsePermissions)(c)}async changeAccount(){await this.ensureInitialized(),await this._api.changeAccount()}async disconnect(){await this.ensureInitialized(),await this._api.disconnect()}async subscribe(s,c){class d{constructor(_,O){this._subscribe=_,this._unsubscribe=O,this._listeners={data:[],subscribed:[],unsubscribed:[]},this._subscribed=!1}on(_,O){return this._listeners[_].push(O),this}async subscribe(){if(!this._subscribed){this._subscribed=!0,await this._subscribe(this);for(const _ of this._listeners.subscribed)_()}}async unsubscribe(){if(!!this._subscribed){this._subscribed=!1,await this._unsubscribe();for(const _ of this._listeners.unsubscribed)_()}}notify(_){for(const O of this._listeners.data)O(_)}}let f=this._getEventSubscriptions(s);const g=(0,r.getUniqueId)();switch(s){case"connected":case"disconnected":case"networkChanged":case"permissionsChanged":case"loggedOut":{const m=new d(async _=>{f[g]==null&&(f[g]=O=>{_.notify(O)})},async()=>{delete f[g]});return await m.subscribe(),m}case"transactionsFound":case"contractStateChanged":{await this.ensureInitialized();const m=c.address.toString(),_=new d(async O=>{if(f[g]!=null)return;f[g]=D=>{D.address.toString()==m&&O.notify(D)};let k=this._contractSubscriptions[m];k==null&&(k={},this._contractSubscriptions[m]=k),k[g]={state:s=="contractStateChanged",transactions:s=="transactionsFound"};const{total:q,withoutExcluded:M}=y(Object.values(k),k[g]);try{(q.transactions!=M.transactions||q.state!=M.state)&&await this.rawApi.subscribe({address:m,subscriptions:q})}catch(D){throw delete f[g],delete k[g],D}},async()=>{delete f[g];const O=this._contractSubscriptions[m];if(O==null)return;const k=O[g],{total:q,withoutExcluded:M}=y(Object.values(O),k);delete O[g],!M.transactions&&!M.state?await this.rawApi.unsubscribe({address:m}):(q.transactions!=M.transactions||q.state!=M.state)&&await this.rawApi.subscribe({address:m,subscriptions:M})});return await _.subscribe(),_}default:throw new Error(`Unknown event ${s}`)}}async getProviderState(){await this.ensureInitialized();const s=await this._api.getProviderState();return{...s,permissions:(0,o.parsePermissions)(s.permissions)}}async getFullContractState(s){return await this.ensureInitialized(),await this._api.getFullContractState({address:s.address.toString()})}async getAccountsByCodeHash(s){await this.ensureInitialized();const{accounts:c,continuation:d}=await this._api.getAccountsByCodeHash({...s});return{accounts:c.map(f=>new r.Address(f)),continuation:d}}async getTransactions(s){await this.ensureInitialized();const{transactions:c,continuation:d,info:f}=await this._api.getTransactions({...s,address:s.address.toString()});return{transactions:c.map(o.parseTransaction),continuation:d,info:f}}async getTransaction(s){await this.ensureInitialized();const{transaction:c}=await this._api.getTransaction({...s});return{transaction:c?(0,o.parseTransaction)(c):void 0}}async getExpectedAddress(s,c){const{address:d}=await this.getStateInit(s,c);return d}async getStateInit(s,c){await this.ensureInitialized();const{address:d,stateInit:f}=await this._api.getExpectedAddress({abi:JSON.stringify(s),...c,initParams:(0,o.serializeTokensObject)(c.initParams)});return{address:new r.Address(d),stateInit:f}}async getBocHash(s){return await this.ensureInitialized(),await this._api.getBocHash({boc:s}).then(({hash:c})=>c)}async packIntoCell(s){return await this.ensureInitialized(),await this._api.packIntoCell({structure:s.structure,data:(0,o.serializeTokensObject)(s.data)})}async unpackFromCell(s){await this.ensureInitialized();const{data:c}=await this._api.unpackFromCell({...s,structure:s.structure});return{data:(0,o.parseTokensObject)(s.structure,c)}}async extractPublicKey(s){await this.ensureInitialized();const{publicKey:c}=await this._api.extractPublicKey({boc:s});return c}async codeToTvc(s){await this.ensureInitialized();const{tvc:c}=await this._api.codeToTvc({code:s});return c}async mergeTvc(s){return await this.ensureInitialized(),await this._api.mergeTvc(s)}async splitTvc(s){return await this.ensureInitialized(),await this._api.splitTvc({tvc:s})}async setCodeSalt(s){let c;if(typeof s.salt=="string")await this.ensureInitialized(),c=s.salt;else{const{boc:d}=await this.packIntoCell(s.salt);c=d}return await this._api.setCodeSalt({code:s.code,salt:c})}async addAsset(s){await this.ensureInitialized();let c;switch(s.type){case"tip3_token":{c={rootContract:s.params.rootContract.toString()};break}default:throw new Error("Unknown asset type")}return await this._api.addAsset({account:s.account.toString(),type:s.type,params:c})}async verifySignature(s){return await this.ensureInitialized(),await this._api.verifySignature(s)}async signData(s){return await this.ensureInitialized(),await this._api.signData(s)}async signDataRaw(s){return await this.ensureInitialized(),await this._api.signDataRaw(s)}async encryptData(s){await this.ensureInitialized();const{encryptedData:c}=await this._api.encryptData(s);return c}async decryptData(s){await this.ensureInitialized();const{data:c}=await this._api.decryptData({encryptedData:s});return c}async sendMessage(s){await this.ensureInitialized();const{transaction:c}=await this._api.sendMessage({...s,sender:s.sender.toString(),recipient:s.recipient.toString(),payload:s.payload?{abi:s.payload.abi,method:s.payload.method,params:(0,o.serializeTokensObject)(s.payload.params)}:void 0});return{transaction:(0,o.parseTransaction)(c)}}_registerEventHandlers(s){const c={connected:d=>d,disconnected:d=>d,transactionsFound:d=>({address:new r.Address(d.address),transactions:d.transactions.map(o.parseTransaction),info:d.info}),contractStateChanged:d=>({address:new r.Address(d.address),state:d.state}),networkChanged:d=>d,permissionsChanged:d=>({permissions:(0,o.parsePermissions)(d.permissions)}),loggedOut:d=>d};for(const[d,f]of Object.entries(c))s.addListener(d,g=>{const m=this._subscriptions[d];if(m==null)return;const _=f(g);for(const O of Object.values(m))O(_)})}_getEventSubscriptions(s){let c=this._subscriptions[s];return c==null&&(c={},this._subscriptions[s]=c),c}}i.ProviderRpcClient=I;class C extends Error{constructor(){super("Everscale provider was not found")}}i.ProviderNotFoundException=C;class E extends Error{constructor(){super("Everscale provider was not initialized yet")}}i.ProviderNotInitializedException=E;function y(l,s){const c={state:!1,transactions:!1},d=Object.assign({},c);for(const f of l){if(d.transactions&&d.state)break;c.state||(c.state=f.state),c.transactions||(c.transactions=f.transactions),f!=s&&(d.state||(d.state=f.state),d.transactions||(d.transactions=f.transactions))}return{total:c,withoutExcluded:d}}})(Z);export{Z as d};
